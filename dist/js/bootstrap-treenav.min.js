/**
* bootstrap-treenav.js v1.0.1 
* Copyright 2016 Bernat Mut
* Copyright 2013 Morris Singer by @morrissinger
* License: Apache-2.0
*/

if(!jQuery)throw new Error("Bootstrap Tree Nav requires jQuery");if("undefined"!=typeof chai)var navTreeTesting=function(){};+function(a){"use strict";var b=[],c=function(b){var c=[];return a(b).children("div").each(function(){a.each(this.attributes,function(){this.specified&&this.name.startsWith("data-")&&this.name.replace("data-","").length>0&&(c[this.name.replace("data-","")]=this.value)})}),c},d=function(b){a.touchtime=[],a(".nav-tree > li").off("click").on("click",function(d){var e=a(this).attr("id");return"undefined"==typeof a.touchtime[e]||0===a.touchtime[e]?a.touchtime[e]=(new Date).getTime():(new Date).getTime()-a.touchtime[e]<800?("function"==typeof b.doubleTap&&b.doubleTap(d,c(this)),a.touchtime[e]=0):a.touchtime[e]=0,!1})},e=function(a,b,c){var d="undefined"!=typeof a.children,f="",g="";if(Object.keys(a).forEach(function(b){if("children"!==b){var c=a[b];null!==c&&(f=f+"data-"+b+'="'+c+'" ')}}),g="<ul>\n",d){var h=[];Object.keys(a.children).forEach(function(d){var f=a.children[d],g=c+1;h[f[b.orderMember]]=e(f,b,g)+"\n"}),h.forEach(function(a){g+=a}),f=f+'data-badge="'+(Object.keys(a.children).length-1)+'" '}return g+="</ul>",'<li  id="li_'+a.id+'"><div class="contentElement" '+f+'><a href="#" id="url_'+a[b.idMember]+'">'+a[b.nameMember]+'</a><span class="buttons pull-right" /></div>'+g+"</li>"},f=function(b){var c=a(b).children("div").children("span.opener");c.removeClass("closed").addClass("opened"),a(b).children("ul").first().slideDown("fast")},g=function(b){var c=a(b).children("div").children("span.opener");c.removeClass("opened").addClass("closed"),a(b).children("ul").first().slideUp("fast")},h=function(b,c){a(b).children("div").children("span.badge").remove(),c.createBadge&&"undefined"!=typeof a(b).children("div").attr("data-badge")&&a(b).children("div").attr("data-badge")>0&&a(b).children("div").append('<span class="badge pull-right">'+a(b).children("div").attr("data-badge")+"</span>")},i=function(a){var b,c,d,e=0;if(0===a.length)return e;for(b=0,d=a.length;b<d;b++)c=a.charCodeAt(b),e=(e<<5)-e+c,e|=0;return e},j=function(b,d){var e=a(b).children("div").children("span.buttons"),f=i(d.class+d.label);e.append('<button class="btn btn-xs  btn-default '+f+" "+d.class+'" title="'+d.label+'"><i class="'+d.icon+'" aria-hidden="true"></i></button>'),"function"==typeof d.click&&a("button."+f).off("click").on("click",function(b){var e=c(a(this).parents("li").first());d.click(b,e)})},k=function(b,c){a(b).children("div").children("span.buttons").html(""),c.buttons.forEach(function(a){j(b,a)})},l=function(b,c,d){a(b).children("div").children("span.opener").remove();var e=a(b).children("ul");e.length>0&&e.children().length&&(a(b).children("div").prepend('<span class="opener '+d+'"><span class="tree-icon-closed"><i class="'+c.navTreeCollapsed+' aria-hidden="true"></i></span><span class="tree-icon-opened"><i class="'+c.navTreeExpanded+'"></i></span></span>'),a(b).children("div").children("a").first().off("click.bs.tree").on("click.bs.tree",function(c){c.preventDefault();var d=a(this).children("span.opener").first();d.hasClass("closed")?(f(b),"#"!==a(this).children("a").attr("href")&&""!==a(this).children("a").attr("href")&&a(this).off("click.bs.tree")):g(b)}),a(b).children("div").children("span.opener").off("click.bs.tree").on("click.bs.tree",function(c){var d=a(this);d.hasClass("closed")?f(b):g(b)}))},m=function(b,c){var d=a(b).children("ul");d.removeClass("nav nav-pills nav-stacked nav-tree "+c.treeClasses).addClass("nav nav-pills nav-stacked nav-tree "+c.treeClasses),d.hide(),l(b,c,"closed")},n=function(b,c){var d=a(b),e=d.find("li");d.removeClass("nav nav-pills nav-stacked nav-tree "+c.treeClasses).addClass("nav nav-pills nav-stacked nav-tree"+c.treeClasses),e.each(function(b,d){m(a(d),c),k(d,c),h(d,c),a(d).hasClass("active")&&a(d).parents("ul").each(function(b,c){a(c).show(),a(c).siblings("div").children("span.opener").first().removeClass("closed").addClass("opened"),"#"!==a(c).find("a").attr("href")&&""!==a(c).find("a").attr("href")&&a(c).siblings("a").off("click.bs.tree")})})};a("ul[data-toggle=nav-tree]").each(function(){var b;b=a(this),b.navTree(b.data())});var o=function(b,c,d){var e=0;a(b).removeClass("nav nav-pills nav-stacked nav-tree"+c.treeClasses).addClass("nav nav-pills nav-stacked nav-tree"+c.treeClasses),a(b).children().each(function(){var b=a(this).children("div");b.attr("data-"+c.orderMember,e),b.attr("data-"+c.parentMember,d),o(a(this).children("ul").first(),c,b.attr("data-"+c.idMember)),b.attr("data-badge",a(this).children("ul").first().children().length),k(this,c),h(this,c),l(this,c,"opened"),e++})},p=function(b,c){a(b).children("ul").nestedSortable({listType:"ul",forcePlaceholderSize:!0,handle:"div",helper:"clone",items:"li",opacity:.6,placeholder:"placeholder",revert:250,tabSize:25,tolerance:"pointer",toleranceElement:"> div",maxLevels:4,isTree:!0,expandOnHover:700,startCollapsed:!1,relocate:function(d,e){o(a(b).children("ul"),c,0)}})},q=function(d,e){var f=[];return a(d).children().each(function(){var d=c(this),g=d[b.idMember];f[g]=d,f[g].children=q(a(this).children("ul").first(),e)}),f},r={getJsonTree:function(){return q(a(this).children("ul"),b)}};a.fn.navTree=function(c){var f=a.fn.navTree.defaults,g=null;if(r[c])return g=a.extend(f,b),b=g,r[c].apply(this,Array.prototype.slice.call(arguments,1));if("object"==typeof c||!c){if(g=a.extend(f,c),b=g,g.enableDragDrop&&"function"!=typeof a.fn.nestedSortable)throw new Error("Bootstrap Tree Nav drag and drop requires jquery-ui-nestedSortable plugin");return this.each(function(){"LI"===a(this).prop("tagName")?n(this,g):"UL"===a(this).prop("tagName")?n(this,g):"DIV"===a(this).prop("tagName")&&(jQuery(this).html('<ul class="nav nav-pills nav-stacked nav-tree '+g.treeClasses+'" id="'+g.treeId+'" data-toggle="nav-tree">'+e(g.source,g)+"</ul>"),g.enableDragDrop&&p(this,g),n(this,g)),d(g)})}},a.fn.navTree.defaults={navTreeExpanded:"fa fa-plus-square",navTreeCollapsed:"fa fa-minus-square",orderMember:"orden",parentMember:"par_id",idMember:"id",nameMember:"name",buttons:[],doubleTap:function(a,b){},enableDragDrop:!1,source:null,treeId:"myTree",treeClasses:"",createBadge:!1},"undefined"!=typeof navTreeTesting&&(navTreeTesting.getData=c,navTreeTesting.createTree=e,navTreeTesting.sortable=p)}(window.jQuery);